{{define "title"}}Dashboard - KWS{{end}}
{{define "page-title"}}Dashboard{{end}}

{{define "content"}}
<div class="space-y-6">
    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Tenants -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Tenants</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">{{.Stats.TenantCount}}</p>
                </div>
                <div class="p-3 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
                    <span class="material-icons-outlined text-blue-600 dark:text-blue-400 text-2xl">business</span>
                </div>
            </div>
            <div class="mt-4 flex items-center text-sm">
                <span class="text-green-600 dark:text-green-400 flex items-center">
                    <span class="material-icons-outlined text-sm mr-1">trending_up</span>
                    {{.Stats.ActiveTenants}} active
                </span>
            </div>
        </div>

        <!-- Sites -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Sites</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">{{.Stats.SiteCount}}</p>
                </div>
                <div class="p-3 bg-purple-100 dark:bg-purple-900/50 rounded-lg">
                    <span class="material-icons-outlined text-purple-600 dark:text-purple-400 text-2xl">location_on</span>
                </div>
            </div>
            <div class="mt-4 flex items-center text-sm">
                <span class="text-green-600 dark:text-green-400 flex items-center">
                    <span class="material-icons-outlined text-sm mr-1">check_circle</span>
                    {{.Stats.ActiveSites}} operational
                </span>
            </div>
        </div>

        <!-- KOS Instances -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">KOS Instances</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">{{.Stats.KOSCount}}</p>
                </div>
                <div class="p-3 bg-green-100 dark:bg-green-900/50 rounded-lg">
                    <span class="material-icons-outlined text-green-600 dark:text-green-400 text-2xl">devices</span>
                </div>
            </div>
            <div class="mt-4 flex items-center text-sm">
                <span class="text-green-600 dark:text-green-400 flex items-center">
                    <span class="material-icons-outlined text-sm mr-1">cloud_done</span>
                    {{.Stats.OnlineKOS}} online
                </span>
                {{if gt .Stats.OfflineKOS 0}}
                <span class="text-red-600 dark:text-red-400 flex items-center ml-3">
                    <span class="material-icons-outlined text-sm mr-1">cloud_off</span>
                    {{.Stats.OfflineKOS}} offline
                </span>
                {{end}}
            </div>
        </div>

        <!-- Orders Today -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Orders Today</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">{{.Stats.OrdersToday}}</p>
                </div>
                <div class="p-3 bg-orange-100 dark:bg-orange-900/50 rounded-lg">
                    <span class="material-icons-outlined text-orange-600 dark:text-orange-400 text-2xl">receipt_long</span>
                </div>
            </div>
            <div class="mt-4 flex items-center text-sm">
                <span class="text-green-600 dark:text-green-400 flex items-center">
                    <span class="material-icons-outlined text-sm mr-1">check</span>
                    {{.Stats.CompletedToday}} completed
                </span>
                {{if gt .Stats.PendingOrders 0}}
                <span class="text-yellow-600 dark:text-yellow-400 flex items-center ml-3">
                    <span class="material-icons-outlined text-sm mr-1">pending</span>
                    {{.Stats.PendingOrders}} pending
                </span>
                {{end}}
            </div>
        </div>
    </div>

    <!-- Recent Activity and Alerts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- KOS Status -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">KOS Instance Status</h2>
                <a href="/kos" class="text-sm text-primary-600 hover:text-primary-700">View All</a>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    {{range .RecentKOS}}
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 rounded-full {{if eq .Status "online"}}bg-green-500{{else if eq .Status "offline"}}bg-red-500{{else}}bg-yellow-500{{end}}"></div>
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">{{.Name}}</p>
                                <p class="text-sm text-gray-500">{{.SiteName}}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 text-xs font-medium rounded-full
                                {{if eq .Status "online"}}bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300
                                {{else if eq .Status "offline"}}bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300
                                {{else}}bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-300{{end}}">
                                {{.Status}}
                            </span>
                            {{if .LastHeartbeat}}
                            <p class="text-xs text-gray-500 mt-1">{{.LastHeartbeat}}</p>
                            {{end}}
                        </div>
                    </div>
                    {{else}}
                    <p class="text-gray-500 text-center py-4">No KOS instances registered</p>
                    {{end}}
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Recent Orders</h2>
                <a href="/orders" class="text-sm text-primary-600 hover:text-primary-700">View All</a>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    {{range .RecentOrders}}
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">{{.OrderReference}}</p>
                            <p class="text-sm text-gray-500">{{.SiteName}} - {{.ItemCount}} items</p>
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 text-xs font-medium rounded-full
                                {{if eq .Status "completed"}}bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300
                                {{else if eq .Status "pending"}}bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-300
                                {{else if eq .Status "in_progress"}}bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300
                                {{else if eq .Status "failed"}}bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300
                                {{else}}bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300{{end}}">
                                {{.Status}}
                            </span>
                            <p class="text-xs text-gray-500 mt-1">{{.CreatedAt}}</p>
                        </div>
                    </div>
                    {{else}}
                    <p class="text-gray-500 text-center py-4">No recent orders</p>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <!-- Alerts -->
    {{if .Alerts}}
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Active Alerts</h2>
        </div>
        <div class="p-6">
            <div class="space-y-3">
                {{range .Alerts}}
                <div class="flex items-start p-4 rounded-lg
                    {{if eq .Severity "critical"}}bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800
                    {{else if eq .Severity "warning"}}bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800
                    {{else}}bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800{{end}}">
                    <span class="material-icons-outlined mr-3
                        {{if eq .Severity "critical"}}text-red-600
                        {{else if eq .Severity "warning"}}text-yellow-600
                        {{else}}text-blue-600{{end}}">
                        {{if eq .Severity "critical"}}error{{else if eq .Severity "warning"}}warning{{else}}info{{end}}
                    </span>
                    <div class="flex-1">
                        <p class="font-medium text-gray-900 dark:text-white">{{.Title}}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">{{.Message}}</p>
                    </div>
                    <span class="text-xs text-gray-500">{{.Timestamp}}</span>
                </div>
                {{end}}
            </div>
        </div>
    </div>
    {{end}}
</div>
{{end}}
