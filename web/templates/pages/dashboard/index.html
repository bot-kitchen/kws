{{define "title"}}Dashboard - KWS{{end}}
{{define "page-title"}}Dashboard{{end}}

{{define "content"}}
<div class="space-y-6">
    <!-- Getting Started (shown when no tenants exist) -->
    {{if eq .TenantCount 0}}
    <div class="bg-gradient-primary rounded-xl shadow-lg p-8 text-white">
        <div class="flex items-start justify-between">
            <div class="flex-1">
                <h2 class="text-2xl font-bold mb-2">Welcome to KWS</h2>
                <p class="text-primary-100 mb-6 max-w-2xl">
                    Kitchen Web Service manages multiple KOS instances across tenants, regions, and sites.
                    Get started by creating your first tenant.
                </p>
                <div class="flex flex-wrap gap-4">
                    <a href="/tenants" class="inline-flex items-center px-5 py-2.5 bg-white text-primary-700 rounded-lg font-semibold hover:bg-primary-50 transition-colors shadow-md">
                        <span class="material-symbols-outlined mr-2">add</span>
                        Create First Tenant
                    </a>
                    <a href="https://github.com/ak/kws#readme" target="_blank" class="inline-flex items-center px-5 py-2.5 bg-primary-500/30 text-white rounded-lg font-medium hover:bg-primary-500/50 transition-colors">
                        <span class="material-symbols-outlined mr-2">menu_book</span>
                        Read Documentation
                    </a>
                </div>
            </div>
            <div class="hidden lg:block">
                <span class="material-symbols-outlined text-8xl text-primary-300/50">rocket_launch</span>
            </div>
        </div>
        <div class="mt-8 pt-6 border-t border-primary-500/30">
            <h3 class="text-sm font-semibold text-primary-200 uppercase tracking-wider mb-4">Setup Steps</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="flex items-center gap-3 p-3 bg-primary-500/20 rounded-lg">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">1</div>
                    <div>
                        <p class="font-medium">Create Tenant</p>
                        <p class="text-xs text-primary-200">Add your first customer</p>
                    </div>
                </div>
                <div class="flex items-center gap-3 p-3 bg-primary-500/20 rounded-lg opacity-60">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">2</div>
                    <div>
                        <p class="font-medium">Add Sites</p>
                        <p class="text-xs text-primary-200">Define kitchen locations</p>
                    </div>
                </div>
                <div class="flex items-center gap-3 p-3 bg-primary-500/20 rounded-lg opacity-60">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">3</div>
                    <div>
                        <p class="font-medium">Register KOS</p>
                        <p class="text-xs text-primary-200">Connect kitchen systems</p>
                    </div>
                </div>
                <div class="flex items-center gap-3 p-3 bg-primary-500/20 rounded-lg opacity-60">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">4</div>
                    <div>
                        <p class="font-medium">Create Recipes</p>
                        <p class="text-xs text-primary-200">Start cooking!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{end}}

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Tenants -->
        <div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-gray-200 dark:border-border-dark p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Tenants</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">{{.Stats.TenantCount}}</p>
                </div>
                <div class="p-3 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
                    <span class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-2xl">business</span>
                </div>
            </div>
            <div class="mt-4 flex items-center text-sm">
                <span class="text-green-600 dark:text-green-400 flex items-center">
                    <span class="material-symbols-outlined text-sm mr-1">trending_up</span>
                    {{.Stats.ActiveTenants}} active
                </span>
            </div>
        </div>

        <!-- Sites -->
        <div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-gray-200 dark:border-border-dark p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Sites</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">{{.Stats.SiteCount}}</p>
                </div>
                <div class="p-3 bg-purple-100 dark:bg-purple-900/50 rounded-lg">
                    <span class="material-symbols-outlined text-purple-600 dark:text-purple-400 text-2xl">location_on</span>
                </div>
            </div>
            <div class="mt-4 flex items-center text-sm">
                <span class="text-green-600 dark:text-green-400 flex items-center">
                    <span class="material-symbols-outlined text-sm mr-1">check_circle</span>
                    {{.Stats.ActiveSites}} operational
                </span>
            </div>
        </div>

        <!-- KOS Instances -->
        <div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-gray-200 dark:border-border-dark p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">KOS Instances</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">{{.Stats.KOSCount}}</p>
                </div>
                <div class="p-3 bg-green-100 dark:bg-green-900/50 rounded-lg">
                    <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-2xl">devices</span>
                </div>
            </div>
            <div class="mt-4 flex items-center text-sm">
                <span class="text-green-600 dark:text-green-400 flex items-center">
                    <span class="material-symbols-outlined text-sm mr-1">cloud_done</span>
                    {{.Stats.OnlineKOS}} online
                </span>
                {{if gt .Stats.OfflineKOS 0}}
                <span class="text-red-600 dark:text-red-400 flex items-center ml-3">
                    <span class="material-symbols-outlined text-sm mr-1">cloud_off</span>
                    {{.Stats.OfflineKOS}} offline
                </span>
                {{end}}
            </div>
        </div>

        <!-- Orders Today -->
        <div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-gray-200 dark:border-border-dark p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Orders Today</p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">{{.Stats.OrdersToday}}</p>
                </div>
                <div class="p-3 bg-orange-100 dark:bg-orange-900/50 rounded-lg">
                    <span class="material-symbols-outlined text-orange-600 dark:text-orange-400 text-2xl">receipt_long</span>
                </div>
            </div>
            <div class="mt-4 flex items-center text-sm">
                <span class="text-green-600 dark:text-green-400 flex items-center">
                    <span class="material-symbols-outlined text-sm mr-1">check</span>
                    {{.Stats.CompletedToday}} completed
                </span>
                {{if gt .Stats.PendingOrders 0}}
                <span class="text-yellow-600 dark:text-yellow-400 flex items-center ml-3">
                    <span class="material-symbols-outlined text-sm mr-1">pending</span>
                    {{.Stats.PendingOrders}} pending
                </span>
                {{end}}
            </div>
        </div>
    </div>

    <!-- Recent Activity and Alerts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- KOS Status -->
        <div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-gray-200 dark:border-border-dark">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-border-dark flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">KOS Instance Status</h2>
                <a href="/kos" class="text-sm text-primary hover:text-primary-hover">View All</a>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    {{range .RecentKOS}}
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 rounded-full {{if eq .Status "online"}}bg-green-500{{else if eq .Status "offline"}}bg-red-500{{else}}bg-yellow-500{{end}}"></div>
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">{{.Name}}</p>
                                <p class="text-sm text-gray-500">{{.SiteName}}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 text-xs font-medium rounded-full
                                {{if eq .Status "online"}}bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300
                                {{else if eq .Status "offline"}}bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300
                                {{else}}bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-300{{end}}">
                                {{.Status}}
                            </span>
                            {{if .LastHeartbeat}}
                            <p class="text-xs text-gray-500 mt-1">{{.LastHeartbeat}}</p>
                            {{end}}
                        </div>
                    </div>
                    {{else}}
                    <p class="text-gray-500 text-center py-4">No KOS instances registered</p>
                    {{end}}
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-gray-200 dark:border-border-dark">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-border-dark flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Recent Orders</h2>
                <a href="/orders" class="text-sm text-primary hover:text-primary-hover">View All</a>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    {{range .RecentOrders}}
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-surface-highlight rounded-lg">
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">{{.OrderReference}}</p>
                            <p class="text-sm text-gray-500">{{.SiteName}} - {{.ItemCount}} items</p>
                        </div>
                        <div class="text-right">
                            <span class="px-2 py-1 text-xs font-medium rounded-full
                                {{if eq .Status "completed"}}bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300
                                {{else if eq .Status "pending"}}bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-300
                                {{else if eq .Status "in_progress"}}bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300
                                {{else if eq .Status "failed"}}bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300
                                {{else}}bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300{{end}}">
                                {{.Status}}
                            </span>
                            <p class="text-xs text-gray-500 mt-1">{{.CreatedAt}}</p>
                        </div>
                    </div>
                    {{else}}
                    <p class="text-gray-500 text-center py-4">No recent orders</p>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <!-- Alerts -->
    {{if .Alerts}}
    <div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-gray-200 dark:border-border-dark">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-border-dark">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Active Alerts</h2>
        </div>
        <div class="p-6">
            <div class="space-y-3">
                {{range .Alerts}}
                <div class="flex items-start p-4 rounded-lg
                    {{if eq .Severity "critical"}}bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800
                    {{else if eq .Severity "warning"}}bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800
                    {{else}}bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800{{end}}">
                    <span class="material-symbols-outlined mr-3
                        {{if eq .Severity "critical"}}text-red-600
                        {{else if eq .Severity "warning"}}text-yellow-600
                        {{else}}text-blue-600{{end}}">
                        {{if eq .Severity "critical"}}error{{else if eq .Severity "warning"}}warning{{else}}info{{end}}
                    </span>
                    <div class="flex-1">
                        <p class="font-medium text-gray-900 dark:text-white">{{.Title}}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">{{.Message}}</p>
                    </div>
                    <span class="text-xs text-gray-500">{{.Timestamp}}</span>
                </div>
                {{end}}
            </div>
        </div>
    </div>
    {{end}}
</div>
{{end}}
